<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RED AI NAVIGATOR</title>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #000000;
            --surface: rgba(255,255,255,0.03);
            --surface-solid: #0a0a0a;
            --elevated: rgba(255,255,255,0.06);
            --border: rgba(255,255,255,0.08);
            --text: #ffffff;
            --text-s: rgba(255,255,255,0.6);
            --text-m: rgba(255,255,255,0.3);
            --accent: #dc2626;
            --accent-s: rgba(220,38,38,0.15);
            --accent-g: rgba(220,38,38,0.4);
            --grad: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
            --success: #22c55e;
            --locked: rgba(255,255,255,0.2);
        }
        [data-theme="light"] {
            --bg: #ffffff;
            --surface: rgba(0,0,0,0.02);
            --surface-solid: #fafafa;
            --elevated: rgba(0,0,0,0.04);
            --border: rgba(0,0,0,0.08);
            --text: #000000;
            --text-s: rgba(0,0,0,0.6);
            --text-m: rgba(0,0,0,0.3);
        }
        *{margin:0;padding:0;box-sizing:border-box}
        html,body{height:100%;overflow:hidden}
        body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text)}

        /* Starfield */
        #stars{position:fixed;inset:0;z-index:0}

        /* Layout */
        .app{position:relative;z-index:1;height:100%;display:grid;grid-template-columns:280px 1fr;grid-template-rows:60px 1fr}

        /* Header */
        .header{grid-column:1/-1;display:flex;align-items:center;justify-content:space-between;padding:0 24px;border-bottom:1px solid var(--border);background:rgba(0,0,0,0.5);backdrop-filter:blur(20px)}
        .header-left{display:flex;align-items:center;gap:16px}
        .menu-btn{display:none;width:40px;height:40px;border:1px solid var(--border);border-radius:10px;background:transparent;color:var(--text);cursor:pointer;font-size:18px}
        .logo{display:flex;align-items:center;gap:12px}
        .logo-icon{width:36px;height:36px;background:var(--grad);border-radius:10px;display:flex;align-items:center;justify-content:center;font-family:'Syne';font-weight:800;font-size:16px;color:#fff}
        .logo-text{font-family:'Syne';font-weight:700;font-size:18px;background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .header-center{display:flex;align-items:center;gap:8px;padding:6px 14px;border:1px solid var(--border);border-radius:20px;font-size:13px;color:var(--text-s)}
        .header-center span{color:var(--accent);font-weight:600}
        .header-right{display:flex;align-items:center;gap:12px}
        .icon-btn{width:40px;height:40px;border-radius:10px;border:1px solid var(--border);background:transparent;cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center;transition:all .2s;color:var(--text)}
        .icon-btn:hover{background:var(--elevated);border-color:var(--accent)}

        /* Sidebar */
        .sidebar{border-right:1px solid var(--border);background:rgba(0,0,0,0.3);backdrop-filter:blur(20px);display:flex;flex-direction:column;overflow:hidden}
        .sidebar-header{padding:20px;border-bottom:1px solid var(--border)}
        .sidebar-title{font-family:'Syne';font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:1.5px;color:var(--text-m);margin-bottom:12px}
        .progress-wrap{background:var(--surface);border-radius:8px;padding:12px}
        .progress-label{display:flex;justify-content:space-between;font-size:12px;margin-bottom:8px}
        .progress-label span:first-child{color:var(--text-s)}
        .progress-label span:last-child{color:var(--accent);font-weight:600}
        .progress-bar{height:4px;background:var(--border);border-radius:2px;overflow:hidden}
        .progress-fill{height:100%;background:var(--grad);border-radius:2px;transition:width .5s}

        .sidebar-modules{flex:1;overflow-y:auto;padding:12px}
        .sidebar-modules::-webkit-scrollbar{width:4px}
        .sidebar-modules::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px}

        .module-group{margin-bottom:20px}
        .module-group-title{font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:1px;color:var(--text-m);padding:8px 12px}

        .module-item{display:flex;align-items:center;gap:12px;padding:12px;border-radius:10px;cursor:pointer;transition:all .2s;margin-bottom:4px}
        .module-item:hover{background:var(--elevated)}
        .module-item.active{background:var(--accent-s);border:1px solid rgba(220,38,38,0.3)}
        .module-item.locked{opacity:0.4;cursor:not-allowed}
        .module-item.locked:hover{background:transparent}
        .module-item.completed .module-status{background:var(--success);color:#fff}

        .module-status{width:28px;height:28px;border-radius:8px;background:var(--surface);display:flex;align-items:center;justify-content:center;font-size:12px;flex-shrink:0}
        .module-item.locked .module-status{background:var(--locked)}
        .module-info{flex:1;min-width:0}
        .module-name{font-size:13px;font-weight:500;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .module-meta{font-size:11px;color:var(--text-m)}

        /* Main Content */
        .main{display:flex;flex-direction:column;overflow:hidden;position:relative}

        /* Chat Area */
        .chat{flex:1;overflow-y:auto;padding:40px;display:flex;flex-direction:column;gap:24px}
        .chat::-webkit-scrollbar{width:6px}
        .chat::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}

        /* Messages */
        .msg{max-width:720px;animation:msgIn .4s ease}
        @keyframes msgIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
        .msg.user{align-self:flex-end}
        .msg-bub{font-size:15px;line-height:1.7}
        .msg.bot .msg-bub{color:var(--text)}
        .msg.user .msg-bub{background:var(--elevated);border:1px solid var(--border);padding:14px 20px;border-radius:16px}
        .msg-bub img{max-width:100%;border-radius:12px;margin-top:12px}

        /* Typing */
        .typing{display:flex;gap:5px}
        .typing span{width:6px;height:6px;background:var(--accent);border-radius:50%;animation:typ 1.4s infinite}
        .typing span:nth-child(2){animation-delay:.15s}
        .typing span:nth-child(3){animation-delay:.3s}
        @keyframes typ{0%,60%,100%{opacity:.3}30%{opacity:1}}

        /* Input Area */
        .input-area{padding:20px 40px 32px;background:linear-gradient(to top,rgba(0,0,0,0.8) 0%,transparent 100%)}
        .input-wrap{max-width:720px;margin:0 auto;background:var(--surface-solid);border:1px solid var(--border);border-radius:16px;padding:4px;display:flex;align-items:flex-end;gap:4px;transition:border-color .2s}
        .input-wrap:focus-within{border-color:var(--accent)}
        .attach{width:44px;height:44px;border-radius:12px;border:none;background:transparent;cursor:pointer;font-size:18px;color:var(--text-s);transition:all .2s}
        .attach:hover{background:var(--elevated);color:var(--text)}
        textarea{flex:1;background:transparent;border:none;padding:12px 8px;font-size:15px;color:var(--text);font-family:'Inter',sans-serif;resize:none;min-height:44px;max-height:120px}
        textarea:focus{outline:none}
        textarea::placeholder{color:var(--text-m)}
        .send{width:44px;height:44px;background:var(--grad);border:none;border-radius:12px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}
        .send:hover{transform:scale(1.05)}
        .send:disabled{opacity:0.5;cursor:not-allowed;transform:scale(1)}
        .send svg{width:18px;height:18px;fill:#fff}

        /* Overlays */
        .overlay{position:fixed;inset:0;z-index:1000;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:40px;background:var(--bg)}
        .overlay.hid{display:none}

        /* Language Screen */
        .lang-logo{display:flex;flex-direction:column;align-items:center;gap:20px}
        .lang-icon{width:80px;height:80px;background:var(--grad);border-radius:20px;display:flex;align-items:center;justify-content:center;font-family:'Syne';font-weight:800;font-size:36px;color:#fff;box-shadow:0 0 80px var(--accent-g);animation:pulse 3s ease-in-out infinite}
        @keyframes pulse{0%,100%{box-shadow:0 0 60px var(--accent-g)}50%{box-shadow:0 0 100px var(--accent-g)}}
        .lang-title{font-family:'Syne';font-weight:800;font-size:32px}
        .lang-sub{font-size:15px;color:var(--text-s);max-width:400px;text-align:center}
        .lang-opts{display:flex;gap:16px}
        .lang-btn{display:flex;flex-direction:column;align-items:center;gap:12px;padding:28px 44px;background:var(--surface);border:1px solid var(--border);border-radius:16px;cursor:pointer;transition:all .3s}
        .lang-btn:hover{border-color:var(--accent);transform:translateY(-4px);box-shadow:0 20px 40px -12px var(--accent-g)}
        .lang-fl{font-size:40px}
        .lang-nm{font-family:'Syne';font-weight:600;font-size:16px;color:var(--text)}

        /* API Key Screen */
        .api-box{max-width:500px;background:var(--surface-solid);border:1px solid var(--border);border-radius:20px;padding:40px;text-align:center}
        .api-title{font-family:'Syne';font-size:24px;font-weight:700;margin-bottom:12px}
        .api-sub{color:var(--text-s);margin-bottom:24px;line-height:1.6;font-size:14px}
        .api-input-wrap{margin-bottom:20px}
        .api-input{width:100%;background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:14px 16px;font-size:14px;color:var(--text);font-family:'Inter',sans-serif;transition:border-color .2s}
        .api-input:focus{outline:none;border-color:var(--accent)}
        .api-input::placeholder{color:var(--text-m)}
        .api-btn{width:100%;background:var(--grad);border:none;padding:14px;border-radius:12px;font-size:15px;font-weight:600;color:#fff;cursor:pointer;transition:all .2s;font-family:'Syne'}
        .api-btn:hover{transform:translateY(-2px);box-shadow:0 12px 24px -8px var(--accent-g)}
        .api-btn:disabled{opacity:0.5;cursor:not-allowed;transform:translateY(0)}
        .api-error{color:#ef4444;font-size:13px;margin-top:12px}
        .api-help{margin-top:20px;padding-top:20px;border-top:1px solid var(--border)}
        .api-help-title{font-size:12px;font-weight:600;color:var(--text-s);margin-bottom:8px}
        .api-help-link{color:var(--accent);font-size:13px;text-decoration:none}
        .api-help-link:hover{text-decoration:underline}

        /* Responsive */
        @media(max-width:900px){
            .app{grid-template-columns:1fr}
            .sidebar{position:fixed;left:0;top:60px;bottom:0;width:280px;z-index:100;transform:translateX(-100%);transition:transform .3s}
            .sidebar.open{transform:translateX(0)}
            .menu-btn{display:flex}
            .header-center{display:none}
        }
        @media(max-width:600px){
            .chat{padding:24px 16px}
            .input-area{padding:16px}
            .lang-opts{flex-direction:column}
            .lang-title{font-size:24px}
            .api-box{padding:24px;margin:20px}
        }

        #fi{display:none}

        /* AI Bullrun Widget */
        .bullrun-widget{position:fixed;top:80px;right:24px;width:300px;background:var(--surface-solid);border:1px solid var(--border);border-radius:16px;padding:20px;z-index:50;box-shadow:0 8px 32px rgba(0,0,0,0.3);display:none}
        .bullrun-title{font-family:'Syne';font-size:16px;font-weight:700;margin-bottom:8px;text-align:center;background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .bullrun-subtitle{font-size:12px;color:var(--text-s);margin-bottom:16px;text-align:center}
        .bullrun-bar-container{position:relative;height:40px;background:var(--surface);border-radius:20px;overflow:hidden;margin-bottom:12px}
        .bullrun-bar{position:absolute;left:0;top:0;height:100%;background:var(--grad);border-radius:20px;transition:width 0.8s cubic-bezier(0.4,0,0.2,1);box-shadow:0 0 20px var(--accent-g);animation:pulse-glow 2s ease-in-out infinite}
        @keyframes pulse-glow{0%,100%{box-shadow:0 0 20px var(--accent-g)}50%{box-shadow:0 0 35px var(--accent),0 0 15px var(--accent-g)}}
        .bullrun-text{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:13px;font-weight:600;z-index:1;text-shadow:0 1px 2px rgba(0,0,0,0.5)}
        .bullrun-stats{display:flex;justify-content:space-between;font-size:11px;color:var(--text-m)}
        .bullrun-close{position:absolute;top:12px;right:12px;width:24px;height:24px;border:none;background:transparent;color:var(--text-m);cursor:pointer;font-size:18px;line-height:1}
        .bullrun-close:hover{color:var(--text)}

        @media(max-width:900px){
            .bullrun-widget{top:70px;right:16px;width:280px;padding:16px}
        }

        /* Admin Modal */
        .admin-modal{position:fixed;inset:0;z-index:2000;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.8);backdrop-filter:blur(10px)}
        .admin-modal.show{display:flex}
        .admin-box{max-width:400px;background:var(--surface-solid);border:2px solid var(--accent);border-radius:20px;padding:40px;text-align:center}
        .admin-title{font-family:'Syne';font-size:20px;font-weight:700;margin-bottom:20px;color:var(--accent)}
        .admin-input{width:100%;background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:14px 16px;font-size:14px;color:var(--text);font-family:'Inter',sans-serif;margin-bottom:16px}
        .admin-input:focus{outline:none;border-color:var(--accent)}
        .admin-btn{width:100%;background:var(--grad);border:none;padding:14px;border-radius:12px;font-size:15px;font-weight:600;color:#fff;cursor:pointer;font-family:'Syne';margin-bottom:8px}
        .admin-btn:hover{opacity:0.9}
        .admin-btn-cancel{background:transparent;border:1px solid var(--border);color:var(--text)}
        .admin-status{margin-top:12px;padding:12px;border-radius:8px;background:var(--accent-s);color:var(--accent);font-size:13px;display:none}
        .admin-status.show{display:block}

        /* Module Completion Popup */
        .completion-overlay{position:fixed;inset:0;z-index:2000;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.95);backdrop-filter:blur(10px)}
        .completion-overlay.show{display:flex;animation:fadeIn 0.5s ease}

        .completion-box{max-width:600px;background:var(--surface-solid);border:2px solid var(--accent);border-radius:24px;padding:48px;text-align:center;position:relative;animation:popIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55)}
        @keyframes popIn{from{transform:scale(0.5);opacity:0}to{transform:scale(1);opacity:1}}

        .completion-icon{width:100px;height:100px;background:var(--grad);border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 24px;font-size:48px;animation:bounce 1s ease infinite;box-shadow:0 0 100px var(--accent-g)}
        @keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-20px)}}

        .completion-title{font-family:'Syne';font-size:32px;font-weight:800;background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:12px}
        .completion-subtitle{font-family:'Syne';font-size:18px;font-weight:600;color:var(--text);margin-bottom:16px}
        .completion-message{color:var(--text-s);font-size:15px;line-height:1.7;margin-bottom:32px}

        .progress-complete{background:var(--surface);border-radius:12px;padding:20px;margin-bottom:32px}
        .progress-complete-label{font-size:13px;color:var(--text-s);margin-bottom:12px}
        .progress-complete-bar{height:12px;background:var(--border);border-radius:6px;overflow:hidden;position:relative}
        .progress-complete-fill{height:100%;background:var(--grad);border-radius:6px;transition:width 2s cubic-bezier(0.68, -0.55, 0.265, 1.55);box-shadow:0 0 20px var(--accent-g)}

        .completion-actions{display:flex;gap:12px}
        .completion-btn{flex:1;padding:16px;border-radius:12px;font-family:'Syne';font-weight:600;font-size:15px;cursor:pointer;transition:all 0.3s;border:none}
        .completion-btn.primary{background:var(--grad);color:#fff}
        .completion-btn.primary:hover{transform:translateY(-2px);box-shadow:0 12px 24px -8px var(--accent-g)}
        .completion-btn.secondary{background:var(--surface);color:var(--text);border:1px solid var(--border)}
        .completion-btn.secondary:hover{background:var(--elevated);border-color:var(--accent)}

        /* Confetti Canvas */
        #confetti{position:fixed;inset:0;z-index:1999;pointer-events:none;display:none}
        #confetti.show{display:block}

        /* Correction Options */
        .correction-options{display:none;flex-direction:column;gap:12px;margin-top:24px}
        .correction-options.show{display:flex}
        .correction-btn{background:var(--elevated);border:1px solid var(--border);padding:14px;border-radius:12px;color:var(--text);font-size:14px;font-weight:500;cursor:pointer;transition:all 0.2s;font-family:'Inter'}
        .correction-btn:hover{background:var(--accent-s);border-color:var(--accent);transform:translateX(4px)}

        /* Marketing Widget */
        .marketing-widget{position:fixed;top:80px;right:24px;width:320px;background:var(--surface-solid);border:1px solid var(--border);border-radius:16px;padding:20px;z-index:50;box-shadow:0 8px 32px rgba(0,0,0,0.3)}
        .marketing-widget-title{font-family:'Syne';font-size:14px;font-weight:700;margin-bottom:12px;text-align:center}
        .marketing-widget-subtitle{font-size:12px;color:var(--text-s);margin-bottom:16px;text-align:center}
        .progress-container{position:relative;height:40px;background:var(--surface);border-radius:20px;overflow:hidden;margin-bottom:12px}
        .progress-glow{position:absolute;left:0;top:0;height:100%;background:linear-gradient(90deg,transparent,var(--accent-g),transparent);border-radius:20px;transition:width 0.8s cubic-bezier(0.4,0,0.2,1);box-shadow:0 0 20px var(--accent-g)}
        .progress-text{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:13px;font-weight:600;z-index:1}
        .widget-stats{display:flex;justify-content:space-between;font-size:11px;color:var(--text-m)}
        .widget-close{position:absolute;top:12px;right:12px;width:24px;height:24px;border:none;background:transparent;color:var(--text-m);cursor:pointer;font-size:16px}
        .widget-close:hover{color:var(--text)}

        /* Notification Popup */
        .notification{position:fixed;bottom:24px;right:24px;min-width:300px;background:var(--surface-solid);border:1px solid var(--success);border-radius:12px;padding:16px 20px;z-index:100;display:flex;align-items:center;gap:12px;box-shadow:0 8px 32px rgba(0,0,0,0.3);animation:slideIn 0.4s ease,slideOut 0.4s ease 2.6s;opacity:0}
        .notification.show{opacity:1}
        @keyframes slideIn{from{transform:translateX(400px);opacity:0}to{transform:translateX(0);opacity:1}}
        @keyframes slideOut{from{transform:translateX(0);opacity:1}to{transform:translateX(400px);opacity:0}}
        .notification-icon{width:40px;height:40px;background:rgba(34,197,94,0.2);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px}
        .notification-content{flex:1}
        .notification-title{font-weight:600;font-size:14px;margin-bottom:2px}
        .notification-text{font-size:12px;color:var(--text-s)}

        @media(max-width:900px){
            .marketing-widget{top:70px;right:16px;width:280px;padding:16px}
            .notification{right:16px;bottom:16px;min-width:280px}
        }
    </style>
</head>
<body>
    <canvas id="stars"></canvas>
    <canvas id="confetti"></canvas>

    <!-- Module Completion Popup -->
    <div class="completion-overlay" id="completionOv">
        <div class="completion-box">
            <div class="completion-icon">üéâ</div>
            <div class="completion-title" id="completionTitle">Gl√ºckwunsch!</div>
            <div class="completion-subtitle" id="completionSubtitle">Modul Abgeschlossen</div>
            <div class="completion-message" id="completionMessage">Deine Informationen wurden gespeichert und ich habe deinen personalisierten Lernpfad vorbereitet!</div>

            <div class="progress-complete">
                <div class="progress-complete-label" id="progressCompleteLabel">Fortschritt: 7%</div>
                <div class="progress-complete-bar">
                    <div class="progress-complete-fill" id="progressCompleteFill" style="width:0%"></div>
                </div>
            </div>

            <div class="completion-actions" id="completionActions">
                <button class="completion-btn primary" onclick="continueToNextModule()" id="continueBtn">Weiter zum n√§chsten Modul ‚Üí</button>
                <button class="completion-btn secondary" onclick="showCorrectionOptions()" id="repeatBtn">üîÑ Modul wiederholen</button>
            </div>

            <div class="correction-options" id="correctionOptions">
                <div style="font-size:14px;color:var(--text-s);margin-bottom:8px;" id="correctionTitle">Welchen Bereich m√∂chtest du korrigieren?</div>
                <button class="correction-btn" onclick="correctField('name')">üë§ <span id="corrField1">Dein Name</span></button>
                <button class="correction-btn" onclick="correctField('goal')">üéØ <span id="corrField2">Dein Ziel</span></button>
                <button class="correction-btn" onclick="correctField('time')">‚è∞ <span id="corrField3">Verf√ºgbare Zeit</span></button>
                <button class="correction-btn" onclick="correctField('experience')">üìö <span id="corrField4">Erfahrungslevel</span></button>
            </div>
        </div>
    </div>

    <!-- Language Selection -->
    <div class="overlay" id="langOv">
        <div class="lang-logo">
            <div class="lang-icon">R</div>
            <div class="lang-title">RED AI NAVIGATOR</div>
            <div class="lang-sub">Master AI and build your income stream with guided learning</div>
        </div>
        <div class="lang-opts">
            <button class="lang-btn" onclick="selectLang('de')"><span class="lang-fl">üá©üá™</span><span class="lang-nm">Deutsch</span></button>
            <button class="lang-btn" onclick="selectLang('en')"><span class="lang-fl">üá¨üáß</span><span class="lang-nm">English</span></button>
            <button class="lang-btn" onclick="selectLang('ru')"><span class="lang-fl">üá∑üá∫</span><span class="lang-nm">–†—É—Å—Å–∫–∏–π</span></button>
        </div>
    </div>

    <!-- API Key Input -->
    <div class="overlay hid" id="apiOv">
        <div class="lang-icon">üîë</div>
        <div class="api-box">
            <div class="api-title" id="apiTitle">Connect Your AI</div>
            <div class="api-sub" id="apiSub">Enter your Anthropic API key to unlock the full RED AI Navigator experience. Your key is stored locally and never shared.</div>
            <div class="api-input-wrap">
                <input type="password" id="apiKey" class="api-input" placeholder="sk-ant-api03-...">
            </div>
            <button class="api-btn" onclick="saveApiKey()" id="apiBtn">Start Journey ‚Üí</button>
            <div class="api-error" id="apiError"></div>
            <div class="api-help">
                <div class="api-help-title">Don't have an API key?</div>
                <a href="https://console.anthropic.com/settings/keys" target="_blank" class="api-help-link">Get one from Anthropic ‚Üí</a>
            </div>
        </div>
    </div>

    <div class="app" style="display:none" id="app">
        <header class="header">
            <div class="header-left">
                <button class="menu-btn" onclick="toggleSidebar()">‚ò∞</button>
                <div class="logo">
                    <div class="logo-icon">R</div>
                    <div class="logo-text">RED AI NAVIGATOR</div>
                </div>
            </div>
            <div class="header-center">
                <span id="currentModule">Intro</span>
            </div>
            <div class="header-right">
                <button class="icon-btn" onclick="toggleTheme()" id="themeBtn">üåô</button>
                <button class="icon-btn" onclick="showApiKeySettings()" title="API Settings">‚öôÔ∏è</button>
            </div>
        </header>

        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">Your Progress</div>
                <div class="progress-wrap">
                    <div class="progress-label">
                        <span>Overall</span>
                        <span id="totalProgress">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width:0%"></div>
                    </div>
                </div>
            </div>
            <div class="sidebar-modules" id="moduleList"></div>
        </aside>

        <main class="main">
            <div class="chat" id="chat"></div>

            <div class="input-area">
                <div class="input-wrap">
                    <button class="attach" onclick="toggleDrop()">üì∑</button>
                    <textarea id="inp" placeholder="Type your answer..." rows="1" onkeydown="handleKey(event)"></textarea>
                    <button class="send" onclick="send()" id="sendBtn">
                        <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
                    </button>
                </div>
            </div>
            <input type="file" id="fi" accept="image/*">
        </main>
    </div>

    <!-- AI Bullrun Widget -->
    <div class="bullrun-widget" id="bullrunWidget">
        <button class="bullrun-close" onclick="closeBullrun()">√ó</button>
        <div class="bullrun-title">AI Bullrun</div>
        <div class="bullrun-subtitle" id="bullrunSubtitle">Menschen verdienen bereits mit AI</div>
        <div class="bullrun-bar-container">
            <div class="bullrun-bar" id="bullrunBar" style="width:47.3%"></div>
            <div class="bullrun-text" id="bullrunText">47,300 / 100,000</div>
        </div>
        <div class="bullrun-stats">
            <span>Start: 2024</span>
            <span>Ziel: 2030</span>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="admin-modal" id="settingsModal">
        <div class="admin-box">
            <div class="admin-title">Einstellungen</div>

            <div style="text-align:left;margin-bottom:20px">
                <label style="font-size:13px;color:var(--text-s);display:block;margin-bottom:8px">API Key</label>
                <input type="password" id="settingsApiKey" class="admin-input" placeholder="sk-ant-api03-...">
            </div>

            <button class="admin-btn" onclick="saveApiKeySettings()">API Key speichern</button>
            <button class="admin-btn admin-btn-cancel" onclick="resetEntireCourse()" style="background:#ef4444;color:#fff;border:none">üîÑ Ganzen Kurs neu starten</button>
            <button class="admin-btn admin-btn-cancel" onclick="closeSettingsModal()">Schlie√üen</button>
            <div class="admin-status" id="settingsStatus"></div>
        </div>
    </div>

    <!-- Admin Modal (hidden, only via shortcut) -->
    <div class="admin-modal" id="adminModal">
        <div class="admin-box">
            <div class="admin-title">Admin Access</div>
            <input type="password" id="adminPassword" class="admin-input" placeholder="Enter password">
            <button class="admin-btn" onclick="submitAdminPassword()">Unlock All Modules</button>
            <button class="admin-btn admin-btn-cancel" onclick="closeAdminModal()">Cancel</button>
            <div class="admin-status" id="adminStatus"></div>
        </div>
    </div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STARFIELD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const canvas = document.getElementById('stars');
const ctx = canvas.getContext('2d');
let stars = [];

function initStars() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    stars = [];
    for (let i = 0; i < 200; i++) {
        stars.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            size: Math.random() * 1.5,
            opacity: Math.random()
        });
    }
}

function animateStars() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    stars.forEach(star => {
        star.opacity += (Math.random() - 0.5) * 0.02;
        star.opacity = Math.max(0.1, Math.min(1, star.opacity));
        ctx.beginPath();
        ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(255,255,255,${star.opacity * 0.6})`;
        ctx.fill();
    });
    requestAnimationFrame(animateStars);
}

window.addEventListener('resize', initStars);
initStars();
animateStars();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE & CONFIG
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const S = {
    lang: null,
    apiKey: localStorage.getItem('red_ai_api_key') || null,
    anthropic: null,
    conversation: [],
    currentModule: 'intro',
    completedModules: [],
    profile: {},
    project: { images: [], notes: [] },
    adminMode: localStorage.getItem('red_ai_admin_mode') === 'true' || false,
    bullrunCount: parseInt(localStorage.getItem('red_ai_bullrun_count')) || 47300,
    bullrunClosed: localStorage.getItem('red_ai_bullrun_closed') === 'true' || false
};

const MODULES = {
    intro: { id: 'intro', group: 'basics', icon: 'üëã', name: { en: 'Introduction', de: 'Einf√ºhrung', ru: '–í–≤–µ–¥–µ–Ω–∏–µ' } },
    what_is_ai: { id: 'what_is_ai', group: 'basics', icon: 'ü§ñ', name: { en: 'What is AI?', de: 'Was ist AI?', ru: '–ß—Ç–æ —Ç–∞–∫–æ–µ AI?' } },
    tokens: { id: 'tokens', group: 'basics', icon: 'üéüÔ∏è', name: { en: 'Tokens', de: 'Tokens', ru: '–¢–æ–∫–µ–Ω—ã' } },
    context: { id: 'context', group: 'basics', icon: 'üìù', name: { en: 'Context', de: 'Kontext', ru: '–ö–æ–Ω—Ç–µ–∫—Å—Ç' } },
    voiceovers: { id: 'voiceovers', group: 'methods', icon: 'üéôÔ∏è', name: { en: 'AI Voiceovers', de: 'AI Voiceovers', ru: 'AI –û–∑–≤—É—á–∫–∞' } },
    imagegen: { id: 'imagegen', group: 'methods', icon: 'üé®', name: { en: 'Image Generation', de: 'Bildgenerierung', ru: '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π' } },
    videogen: { id: 'videogen', group: 'methods', icon: 'üé¨', name: { en: 'Video Generation', de: 'Videogenerierung', ru: '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ' } },
    chatbots: { id: 'chatbots', group: 'methods', icon: 'üí¨', name: { en: 'Chatbots', de: 'Chatbots', ru: '–ß–∞—Ç–±–æ—Ç—ã' } },
    automation: { id: 'automation', group: 'methods', icon: '‚öôÔ∏è', name: { en: 'Automation', de: 'Automatisierung', ru: '–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è' } },
    copywriting: { id: 'copywriting', group: 'methods', icon: '‚úçÔ∏è', name: { en: 'Copywriting', de: 'Copywriting', ru: '–ö–æ–ø–∏—Ä–∞–π—Ç–∏–Ω–≥' } },
    websites: { id: 'websites', group: 'methods', icon: 'üíª', name: { en: 'AI Websites', de: 'AI Websites', ru: 'AI –°–∞–π—Ç—ã' } },
    research: { id: 'research', group: 'methods', icon: 'üìä', name: { en: 'AI Research', de: 'AI Research', ru: 'AI –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è' } },
    consulting: { id: 'consulting', group: 'methods', icon: 'üéì', name: { en: 'AI Consulting', de: 'AI Consulting', ru: 'AI –ö–æ–Ω—Å–∞–ª—Ç–∏–Ω–≥' } },
    choose_path: { id: 'choose_path', group: 'decision', icon: 'üéØ', name: { en: 'Choose Path', de: 'W√§hle Weg', ru: '–í—ã–±–µ—Ä–∏ –ø—É—Ç—å' } },
    project: { id: 'project', group: 'project', icon: 'üöÄ', name: { en: 'Your Project', de: 'Dein Projekt', ru: '–¢–≤–æ–π –ø—Ä–æ–µ–∫—Ç' } }
};

const GROUPS = {
    basics: { en: 'Fundamentals', de: 'Grundlagen', ru: '–û—Å–Ω–æ–≤—ã' },
    methods: { en: 'AI Methods', de: 'AI Methoden', ru: 'AI –ú–µ—Ç–æ–¥—ã' },
    decision: { en: 'Your Path', de: 'Dein Weg', ru: '–¢–≤–æ–π –ø—É—Ç—å' },
    project: { en: 'Your Project', de: 'Dein Projekt', ru: '–¢–≤–æ–π –ø—Ä–æ–µ–∫—Ç' }
};

const i18n = {
    en: {
        apiTitle: 'Connect Your AI',
        apiSub: 'Enter your Anthropic API key to unlock the full RED AI Navigator experience. Your key is stored locally and never shared.',
        apiBtn: 'Start Journey ‚Üí',
        apiError: 'Invalid API key. Please check and try again.',
        apiHelp: "Don't have an API key?",
        apiHelpLink: 'Get one from Anthropic ‚Üí',
        widgetTitle: 'AI Money Wave 2030',
        widgetSubtitle: 'People already earning with AI',
        widgetStat1: 'Started: 2024',
        widgetStat2: 'Target: 2030',
        notifTitle: 'New AI Earner',
        notifText: 'Someone just earned their first money with AI'
    },
    de: {
        apiTitle: 'Verbinde deine AI',
        apiSub: 'Gib deinen Anthropic API Key ein um die volle RED AI Navigator Erfahrung freizuschalten. Dein Key wird nur lokal gespeichert.',
        apiBtn: 'Reise Starten ‚Üí',
        apiError: 'Ung√ºltiger API Key. Bitte pr√ºfen.',
        apiHelp: 'Noch keinen API Key?',
        apiHelpLink: 'Hol dir einen bei Anthropic ‚Üí',
        widgetTitle: 'AI Geld Welle 2030',
        widgetSubtitle: 'Menschen verdienen bereits mit AI',
        widgetStat1: 'Start: 2024',
        widgetStat2: 'Ziel: 2030',
        notifTitle: 'Neuer AI Verdiener',
        notifText: 'Jemand hat gerade sein erstes Geld mit AI verdient'
    },
    ru: {
        apiTitle: '–ü–æ–¥–∫–ª—é—á–∏ —Å–≤–æ–π AI',
        apiSub: '–í–≤–µ–¥–∏ —Å–≤–æ–π Anthropic API –∫–ª—é—á —á—Ç–æ–±—ã —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π –æ–ø—ã—Ç RED AI Navigator. –ö–ª—é—á —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ.',
        apiBtn: '–ù–∞—á–∞—Ç—å –ü—É—Ç—å ‚Üí',
        apiError: '–ù–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á. –ü—Ä–æ–≤–µ—Ä—å.',
        apiHelp: '–ù–µ—Ç API –∫–ª—é—á–∞?',
        apiHelpLink: '–ü–æ–ª—É—á–∏ —É Anthropic ‚Üí',
        widgetTitle: 'AI –î–µ–Ω–µ–∂–Ω–∞—è –í–æ–ª–Ω–∞ 2030',
        widgetSubtitle: '–õ—é–¥–∏ —É–∂–µ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç —Å AI',
        widgetStat1: '–ù–∞—á–∞–ª–æ: 2024',
        widgetStat2: '–¶–µ–ª—å: 2030',
        notifTitle: '–ù–æ–≤—ã–π AI –ó–∞—Ä–∞–±–æ—Ç—á–∏–∫',
        notifText: '–ö—Ç–æ-—Ç–æ —Ç–æ–ª—å–∫–æ —á—Ç–æ –∑–∞—Ä–∞–±–æ—Ç–∞–ª –ø–µ—Ä–≤—ã–µ –¥–µ–Ω—å–≥–∏ —Å AI'
    }
};

function t(key) {
    return i18n[S.lang]?.[key] || i18n.en[key] || key;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LANGUAGE & API KEY SETUP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function selectLang(lang) {
    S.lang = lang;
    document.getElementById('langOv').classList.add('hid');

    // Update API screen text
    document.getElementById('apiTitle').textContent = t('apiTitle');
    document.getElementById('apiSub').textContent = t('apiSub');
    document.getElementById('apiBtn').textContent = t('apiBtn');

    // Show API screen or skip if already have key
    if (S.apiKey) {
        initAnthropic();
        startApp();
    } else {
        document.getElementById('apiOv').classList.remove('hid');
    }
}

function saveApiKey() {
    const key = document.getElementById('apiKey').value.trim();
    if (!key || !key.startsWith('sk-ant-')) {
        document.getElementById('apiError').textContent = t('apiError');
        return;
    }

    S.apiKey = key;
    localStorage.setItem('red_ai_api_key', key);
    document.getElementById('apiError').textContent = '';

    initAnthropic();
    startApp();
}

function initAnthropic() {
    // API calls will be made directly via fetch
    console.log('API Key configured');
}

function resetApiKey() {
    localStorage.removeItem('red_ai_api_key');
    location.reload();
}

function startApp() {
    document.getElementById('apiOv').classList.add('hid');
    document.getElementById('app').style.display = 'grid';
    renderModuleList();
    initModule('intro');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MODULE SYSTEM
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderModuleList() {
    const list = document.getElementById('moduleList');
    const moduleArray = Object.values(MODULES);
    const groups = {};

    moduleArray.forEach((m, i) => {
        if (!groups[m.group]) groups[m.group] = [];
        groups[m.group].push({ ...m, index: i });
    });

    list.innerHTML = Object.entries(groups).map(([group, modules]) => `
        <div class="module-group">
            <div class="module-group-title">${GROUPS[group][S.lang] || group}</div>
            ${modules.map(m => {
                const isLocked = m.index > 0 && !S.completedModules.includes(moduleArray[m.index - 1].id);
                const isCompleted = S.completedModules.includes(m.id);
                const isActive = S.currentModule === m.id;
                return `
                    <div class="module-item ${isLocked ? 'locked' : ''} ${isCompleted ? 'completed' : ''} ${isActive ? 'active' : ''}"
                         onclick="${isLocked ? '' : `selectModule('${m.id}')`}">
                        <div class="module-status">${isCompleted ? '‚úì' : isLocked ? 'üîí' : m.icon}</div>
                        <div class="module-info">
                            <div class="module-name">${m.name[S.lang] || m.name.en}</div>
                            <div class="module-meta">${isCompleted ? 'Completed' : isLocked ? 'Locked' : 'Active'}</div>
                        </div>
                    </div>
                `;
            }).join('')}
        </div>
    `).join('');

    updateProgress();
}

function updateProgress() {
    const total = Object.keys(MODULES).length;
    const completed = S.completedModules.length;
    const pct = Math.round((completed / total) * 100);
    document.getElementById('progressFill').style.width = pct + '%';
    document.getElementById('totalProgress').textContent = pct + '%';
    document.getElementById('currentModule').textContent = MODULES[S.currentModule]?.name[S.lang] || 'Navigator';
}

function selectModule(moduleId) {
    S.currentModule = moduleId;
    document.getElementById('chat').innerHTML = '';
    renderModuleList();
    initModule(moduleId);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AI CONVERSATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const SYSTEM_PROMPTS = {
    intro: `You are the RED AI Navigator assistant. You're guiding the user through an introduction module.
Your goal: Learn their name, their main goal (side income, full-time income, or exploring), and how much time they can invest daily.
Be friendly, concise, and encouraging. After gathering this info, congratulate them and tell them they've completed the intro module.
Always respond in {LANG} language.`,

    what_is_ai: `You are teaching about AI basics. Explain what AI is, different types (LLMs, Image AI, Voice AI, Video AI), and their applications.
Include interactive quizzes. Be educational but keep it practical and income-focused.
Always respond in {LANG} language.`,

    tokens: `You are teaching about tokens in AI. Explain what tokens are, how they work, pricing, and why it matters for costs.
Give practical examples. Include a quiz about token counts.
Always respond in {LANG} language.`,

    context: `You are teaching about context in AI. Explain why context is crucial for quality outputs, how to structure good prompts.
Be practical with examples from real use cases.
Always respond in {LANG} language.`,

    voiceovers: `You are teaching AI Voiceovers income method. Be detailed and practical.

CONTENT TO COVER:
1. **What are AI Voiceovers?**
   - AI-generated natural voice for videos, audiobooks, ads, courses
   - Use cases: YouTube videos, podcasts, explainer videos, e-learning, audiobooks

2. **Best Tools:**
   - **ElevenLabs** (https://elevenlabs.io) - Most natural voices, emotion control
   - **Play.ht** (https://play.ht) - Great for long-form content
   - **Murf.ai** (https://murf.ai) - Professional studio features

3. **Getting Started:**
   - Sign up for free trial (most offer 10-30min free)
   - Choose voice that fits your niche
   - Test with short script first
   - Watch setup tutorial: Search YouTube for "ElevenLabs Tutorial 2024"

4. **Income Potential: ‚Ç¨500-2000/month**
   - Fiverr/Upwork: ‚Ç¨20-100 per voiceover
   - YouTube channel voiceovers: ‚Ç¨100-500/video
   - Audiobook narration: ‚Ç¨50-200 per hour of audio
   - Corporate videos: ‚Ç¨200-1000 per project

5. **How to Find Clients:**
   - Create Fiverr gig showcasing voice samples
   - Join Upwork and bid on voiceover projects
   - Reach out to YouTubers who need consistent voiceovers
   - Offer services to local businesses for ads/training videos

**ACTION STEP:** After completing this module, sign up for a free ElevenLabs account and generate your first test voiceover.

Always respond in {LANG} language.`,

    imagegen: `You are teaching AI Image Generation income method. Be detailed and practical.

CONTENT TO COVER:
1. **What is AI Image Generation?**
   - Creating professional images, art, designs with AI
   - Use cases: social media content, book covers, ads, print-on-demand, stock photos

2. **Best Tools:**
   - **Midjourney** (https://midjourney.com) - Highest quality, requires Discord
   - **Leonardo.ai** (https://leonardo.ai) - Great for consistent character generation
   - **DALL-E 3** via ChatGPT Plus - Most accessible, integrated
   - **Stable Diffusion** (free, open-source) - Full control, needs technical setup

3. **Prompting Tips:**
   - Be specific: "photorealistic portrait of a CEO, 40s, in modern office, natural lighting"
   - Style keywords: "cinematic, 8k, professional photography, studio lighting"
   - Use aspect ratios: --ar 16:9 for YouTube thumbnails, --ar 1:1 for Instagram

4. **Income Potential: ‚Ç¨800-3000/month**
   - Social media graphics: ‚Ç¨50-200 per package
   - Book covers: ‚Ç¨100-500 per cover
   - Print-on-demand designs: ‚Ç¨500-2000/month passive
   - Stock photo generation: ‚Ç¨20-100 per photo set
   - YouTube thumbnails: ‚Ç¨10-50 per thumbnail

5. **Getting Started:**
   - Start with free tier of Leonardo.ai or DALL-E
   - Practice prompting daily (30min for 7 days)
   - Create portfolio of 20-30 best images
   - Watch "Midjourney Prompting Guide 2024" on YouTube

6. **Registration & Platforms:**
   - Sign up: Midjourney (via Discord), Leonardo.ai (email)
   - Sell on: Etsy (print-on-demand), Creative Market, Fiverr
   - After mastering basics, you'll get detailed client acquisition strategies

Always respond in {LANG} language.`,

    videogen: `You are teaching AI Video Generation. Provide comprehensive details.

CONTENT TO COVER:
1. **Tools:**
   - **Runway** (https://runwayml.com) - Video editing, Gen-2 for video from text
   - **Pika** (https://pika.art) - Fast video generation
   - **HeyGen** (https://heygen.com) - AI avatars for faceless videos

2. **Use Cases:**
   - Faceless YouTube channels (‚Ç¨1000-5000/month with monetization)
   - Social media shorts
   - Product demos
   - Educational content

3. **Getting Started:**
   - Most tools offer free trials
   - Start with simple prompts
   - Search YouTube: "AI Video Generation Tutorial 2024"

4. **Registration:** Sign up at respective websites with email. After module completion, you'll get detailed monetization strategies.

Always respond in {LANG} language.`,

    chatbots: `You are teaching AI Chatbots for business income.

CONTENT TO COVER:
1. **Business Applications:**
   - Customer service automation (24/7 support)
   - Lead generation and qualification
   - Appointment scheduling
   - FAQ handling

2. **Tools & Platforms:**
   - **Voiceflow** (https://voiceflow.com) - Visual chatbot builder
   - **Botpress** - Open-source, customizable
   - **ManyChat** - WhatsApp/Instagram bots
   - Or use Claude API + simple interface

3. **Income Potential: ‚Ç¨2000-10000/month**
   - Setup fee: ‚Ç¨1000-5000 per client
   - Monthly maintenance: ‚Ç¨200-1000/client
   - You only need 3-5 clients for solid income

4. **How to Get Clients:**
   - Approach local businesses (restaurants, doctors, lawyers)
   - Offer free demo chatbot
   - Show time/cost savings (1 chatbot = 1-2 employees)
   - Join entrepreneur Facebook groups and offer services

5. **Getting Started:**
   - Build your own website chatbot as demo
   - Complete Voiceflow free tutorials
   - After this module, you'll receive client scripts and pricing templates

Always respond in {LANG} language.`,

    automation: `You are teaching AI Automation for business income.

CONTENT TO COVER:
1. **What is AI Automation?**
   - Connecting apps and services to run automatically
   - Examples: Auto-respond to emails, data entry, social media posting, lead management

2. **Tools:**
   - **Make.com** (https://make.com) - Visual automation, AI integrations
   - **Zapier** (https://zapier.com) - Easiest to start, 6000+ app integrations
   - **n8n** - Open-source, self-hosted for advanced users

3. **Income Potential: ‚Ç¨1500-5000/month**
   - Automation setup: ‚Ç¨500-3000 per workflow
   - Monthly management: ‚Ç¨200-800 per client
   - Most clients need 2-5 automations

4. **Common Automations Businesses Need:**
   - Email to CRM sync
   - Social media auto-posting
   - Invoice generation
   - Customer onboarding sequences
   - Report generation

5. **Getting Started:**
   - Sign up for Make.com free account
   - Build 3-5 automations for yourself
   - Watch "Make.com Tutorial 2024" on YouTube
   - Create demo automations to show potential clients

6. **Finding Clients:**
   - After completion, you'll get outreach templates and pricing strategies

Always respond in {LANG} language.`,

    copywriting: `You are teaching AI Copywriting for income.

CONTENT TO COVER:
1. **Frameworks:**
   - **AIDA**: Attention, Interest, Desire, Action
   - **PAS**: Problem, Agitate, Solution
   - **BAB**: Before, After, Bridge

2. **Tools:**
   - Claude (Anthropic) - Best for long-form, contextual writing
   - ChatGPT - Versatile, widely known
   - Copy.ai, Jasper - Specialized for marketing copy

3. **Income Potential: ‚Ç¨1000-5000/month**
   - Website copy: ‚Ç¨300-1500 per site
   - Email sequences: ‚Ç¨200-1000 per sequence
   - Social media content: ‚Ç¨300-800/month retainer
   - Ad copy: ‚Ç¨100-500 per campaign

4. **Services to Offer:**
   - Website landing pages
   - Email marketing campaigns
   - Social media captions
   - Product descriptions
   - Blog posts and articles

5. **Getting First Clients:**
   - Offer free website copy audit
   - Rewrite bad copy as portfolio examples
   - Join copywriting Facebook groups
   - Pitch local businesses with weak web presence

After this module, you'll receive pitch templates and portfolio-building strategies.

Always respond in {LANG} language.`,

    websites: `You are teaching AI Website Building for income.

CONTENT TO COVER:
1. **No-Code AI Tools:**
   - **v0.dev** (Vercel) - Generate React components from text
   - **Framer** (https://framer.com) - AI-powered design to real websites
   - **Webflow** (https://webflow.com) - Professional without coding
   - **Cursor** - AI code editor for developers

2. **Income Potential: ‚Ç¨1000-4000/month**
   - Simple website: ‚Ç¨500-2000
   - E-commerce store: ‚Ç¨1500-5000
   - Landing page: ‚Ç¨300-1000
   - Monthly maintenance: ‚Ç¨100-500/client

3. **Getting Started:**
   - Build your own portfolio site with Framer (free)
   - Practice by rebuilding existing websites
   - Watch "Framer AI Tutorial 2024" on YouTube

4. **Finding Clients:**
   - Approach businesses with outdated websites
   - Offer before/after redesigns
   - Partner with marketing agencies
   - After completion: detailed client scripts and proposal templates

Always respond in {LANG} language.`,

    research: `You are teaching AI Research Services for income.

CONTENT TO COVER:
1. **Services You Can Offer:**
   - Market research reports
   - Competitor analysis
   - Customer survey analysis
   - Industry trend reports
   - Data processing and summarization

2. **Tools:**
   - Claude for analysis and synthesis
   - Perplexity.ai for research
   - ChatGPT with web browsing
   - Google Scholar + AI summaries

3. **Income Potential: ‚Ç¨1000-4000/month**
   - Research report: ‚Ç¨300-1500
   - Ongoing research retainer: ‚Ç¨500-2000/month
   - Quick market analysis: ‚Ç¨150-500

4. **Target Clients:**
   - Startups needing market validation
   - Established companies entering new markets
   - Consultants needing research support
   - Content creators needing data

5. **Getting Started:**
   - Create sample research report in your niche
   - Offer free market snapshot to get first client
   - After module: client templates and report structures

Always respond in {LANG} language.`,

    consulting: `You are teaching AI Consulting - the highest income potential method.

CONTENT TO COVER:
1. **What AI Consultants Do:**
   - Strategy: Help businesses identify AI opportunities
   - Implementation: Set up AI tools and workflows
   - Training: Teach teams to use AI effectively
   - Ongoing optimization: Improve AI systems

2. **Pricing Models:**
   - Hourly: ‚Ç¨100-300/hour
   - Project-based: ‚Ç¨1000-10000+ per project
   - Retainer: ‚Ç¨2000-8000/month for ongoing support

3. **Income Potential: ‚Ç¨3000-20000/month**
   - This is the highest-earning AI method
   - One good client can be ‚Ç¨3000-5000/month
   - You only need 2-4 retainer clients for full-time income

4. **Services Structure:**
   - Discovery call: ‚Ç¨200-500 (later credited)
   - AI audit report: ‚Ç¨1000-3000
   - Implementation package: ‚Ç¨3000-10000
   - Monthly retainer: ‚Ç¨2000-5000

5. **How to Position Yourself:**
   - Focus on one industry (real estate, e-commerce, agencies)
   - Create case studies (start with discounted projects)
   - Speak at local business events
   - LinkedIn content showcasing AI knowledge

6. **Getting First Clients:**
   - Offer free AI opportunity assessment
   - Create "10 Ways [Industry] Can Use AI" report
   - After this module: positioning templates, pricing strategies, and sales scripts

Always respond in {LANG} language.`,

    choose_path: `You are helping the user choose their AI income path. They've learned all 9 methods. Help them pick 1-3 that fit their profile.
Also present the option for premium 1:1 guidance with branding/marketing (‚Ç¨3k+ investment).
Always respond in {LANG} language.`,

    project: `You are the user's personal AI project coach. Help them set specific goals, analyze screenshots they upload, give actionable advice.
Be supportive, strategic, and focused on their chosen income methods. Reference their profile data.
Always respond in {LANG} language.`
};

function getSystemPrompt(moduleId) {
    const langNames = { en: 'English', de: 'German', ru: 'Russian' };
    let prompt = SYSTEM_PROMPTS[moduleId] || SYSTEM_PROMPTS.intro;
    prompt = prompt.replace('{LANG}', langNames[S.lang] || 'English');

    // Add profile context if available
    if (Object.keys(S.profile).length > 0) {
        prompt += `\n\nUser Profile: ${JSON.stringify(S.profile)}`;
    }

    return prompt;
}

async function callAnthropic(messages, system) {
    const response = await fetch('https://api-proxy-rho-five.vercel.app/api/claude', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'x-api-key': S.apiKey,
            'anthropic-version': '2023-06-01'
        },
        body: JSON.stringify({
            model: 'claude-3-haiku-20240307',
            max_tokens: 4096,
            system: system,
            messages: messages
        })
    });

    if (!response.ok) {
        throw new Error(`API Error: ${response.status}`);
    }

    return await response.json();
}

async function initModule(moduleId) {
    // Clear conversation for new module
    S.conversation = [];

    // Add initial AI message
    addTyping();

    try {
        const response = await callAnthropic([{
            role: 'user',
            content: `Start the ${moduleId} module. Greet me and begin the lesson.`
        }], getSystemPrompt(moduleId));

        removeTyping();
        const text = response.content[0].text;
        S.conversation.push({ role: 'assistant', content: text });
        addBot(text);

    } catch (e) {
        removeTyping();
        console.error('AI Error:', e);
        const errorMsg = '‚ö†Ô∏è Connection error. Please check your API key. <button onclick="resetApiKey()" style="margin-left:10px;padding:8px 16px;background:#dc2626;color:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:600;">Reset API Key</button>';
        addBot(errorMsg);
    }
}

async function send() {
    const txt = document.getElementById('inp').value.trim();
    if (!txt) return;

    addUser(txt);
    document.getElementById('inp').value = '';
    document.getElementById('inp').style.height = 'auto';

    // Add to conversation
    S.conversation.push({ role: 'user', content: txt });

    // Show typing
    addTyping();
    document.getElementById('sendBtn').disabled = true;

    try {
        const response = await callAnthropic(S.conversation, getSystemPrompt(S.currentModule));

        removeTyping();
        document.getElementById('sendBtn').disabled = false;

        const text = response.content[0].text;
        S.conversation.push({ role: 'assistant', content: text });
        addBot(text);

        // Check if module complete (AI mentions it)
        if (text.toLowerCase().includes('module complete') ||
            text.toLowerCase().includes('modul abgeschlossen') ||
            text.toLowerCase().includes('–º–æ–¥—É–ª—å –∑–∞–≤–µ—Ä—à—ë–Ω')) {
            setTimeout(() => completeModule(S.currentModule), 2000);
        }

    } catch (e) {
        removeTyping();
        document.getElementById('sendBtn').disabled = false;
        console.error('AI Error:', e);
        const errorMsg = '‚ö†Ô∏è Error communicating with AI. <button onclick="resetApiKey()" style="margin-left:10px;padding:8px 16px;background:#dc2626;color:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:600;">Reset API Key</button>';
        addBot(errorMsg);
    }
}

function completeModule(moduleId) {
    if (!S.completedModules.includes(moduleId)) {
        S.completedModules.push(moduleId);
        localStorage.setItem('red_ai_completed', JSON.stringify(S.completedModules));
    }

    renderModuleList();

    // Move to next module
    const moduleIds = Object.keys(MODULES);
    const currentIndex = moduleIds.indexOf(moduleId);
    if (currentIndex < moduleIds.length - 1) {
        const nextId = moduleIds[currentIndex + 1];
        setTimeout(() => {
            if (confirm(`Great! Ready for the next module: ${MODULES[nextId].name[S.lang]}?`)) {
                selectModule(nextId);
            }
        }, 1000);
    }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UI HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function addBot(msg) {
    const chat = document.getElementById('chat');
    const div = document.createElement('div');
    div.className = 'msg bot';
    div.innerHTML = `<div class="msg-bub">${msg.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}</div>`;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
}

function addUser(txt, img = null) {
    const chat = document.getElementById('chat');
    const div = document.createElement('div');
    div.className = 'msg user';
    div.innerHTML = `<div class="msg-bub">${txt}${img ? `<img src="${img}">` : ''}</div>`;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
}

function addTyping() {
    const chat = document.getElementById('chat');
    const div = document.createElement('div');
    div.className = 'msg bot typing-msg';
    div.innerHTML = '<div class="msg-bub"><div class="typing"><span></span><span></span><span></span></div></div>';
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
}

function removeTyping() {
    const typing = document.querySelector('.typing-msg');
    if (typing) typing.remove();
}

function toggleTheme() {
    const th = document.documentElement.dataset.theme === 'dark' ? 'light' : 'dark';
    document.documentElement.dataset.theme = th;
    document.getElementById('themeBtn').textContent = th === 'dark' ? 'üåô' : '‚òÄÔ∏è';
}

function toggleSidebar() {
    document.getElementById('sidebar').classList.toggle('open');
}

// Input handling
const inp = document.getElementById('inp');
inp.addEventListener('input', function() {
    this.style.height = 'auto';
    this.style.height = Math.min(this.scrollHeight, 120) + 'px';
});

function handleKey(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        send();
    }
}

// File upload
const fi = document.getElementById('fi');
function toggleDrop() { fi.click(); }
fi.addEventListener('change', async (e) => {
    const f = e.target.files[0];
    if (!f?.type.startsWith('image/')) return;

    const r = new FileReader();
    r.onload = async (ev) => {
        const base64 = ev.target.result.split(',')[1];
        S.project.images.push(base64);

        addUser('üì∑ Image uploaded', ev.target.result);
        addTyping();

        // Send image to AI
        try {
            const imageMessage = {
                role: 'user',
                content: [
                    { type: 'image', source: { type: 'base64', media_type: f.type, data: base64 } },
                    { type: 'text', text: 'I uploaded this image. Please analyze it and give me feedback.' }
                ]
            };

            const response = await callAnthropic([...S.conversation, imageMessage], getSystemPrompt(S.currentModule));

            removeTyping();
            const text = response.content[0].text;
            S.conversation.push(imageMessage);
            S.conversation.push({ role: 'assistant', content: text });
            addBot(text);

        } catch (e) {
            removeTyping();
            console.error('Image analysis error:', e);
            addBot("I received your image! I'll analyze it to help with your project.");
        }
    };
    r.readAsDataURL(f);
});

// Load completed modules from storage
const saved = localStorage.getItem('red_ai_completed');
if (saved) {
    try {
        S.completedModules = JSON.parse(saved);
    } catch (e) {}
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ADMIN MODE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// Global keyboard shortcut for admin mode
document.addEventListener('keydown', (e) => {
    // Ctrl+Cmd+L (Mac) or Ctrl+Alt+L (Windows/Linux)
    const isMac = (e.ctrlKey && e.metaKey && e.key.toLowerCase() === 'l');
    const isWindows = (e.ctrlKey && e.altKey && e.key.toLowerCase() === 'l');

    if (isMac || isWindows) {
        e.preventDefault();
        console.log('Admin shortcut triggered!');
        openAdminModal();
    }
}, true); // Use capture phase to catch before other handlers

function openAdminModal() {
    document.getElementById('adminModal').classList.add('show');
    document.getElementById('adminPassword').value = '';
    document.getElementById('adminStatus').classList.remove('show');
    setTimeout(() => document.getElementById('adminPassword').focus(), 100);
}

function closeAdminModal() {
    document.getElementById('adminModal').classList.remove('show');
}

function submitAdminPassword() {
    const password = document.getElementById('adminPassword').value;
    const statusEl = document.getElementById('adminStatus');

    if (password === 'administrator') {
        S.adminMode = true;
        localStorage.setItem('red_ai_admin_mode', 'true');

        // Unlock all modules
        const allModuleIds = Object.keys(MODULES);
        S.completedModules = allModuleIds.slice(0, -1); // All except last to keep it interesting
        localStorage.setItem('red_ai_completed', JSON.stringify(S.completedModules));

        statusEl.textContent = '‚úì Admin mode activated! All modules unlocked.';
        statusEl.style.background = 'rgba(34,197,94,0.2)';
        statusEl.style.color = '#22c55e';
        statusEl.classList.add('show');

        renderModuleList();

        setTimeout(() => {
            closeAdminModal();
        }, 1500);
    } else {
        statusEl.textContent = '‚úó Invalid password';
        statusEl.style.background = 'var(--accent-s)';
        statusEl.style.color = 'var(--accent)';
        statusEl.classList.add('show');
    }
}

// Allow Enter key in admin password field
document.addEventListener('DOMContentLoaded', () => {
    const adminPasswordInput = document.getElementById('adminPassword');
    if (adminPasswordInput) {
        adminPasswordInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                submitAdminPassword();
            }
        });
    }
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AI BULLRUN WIDGET
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateBullrun() {
    const widget = document.getElementById('bullrunWidget');

    if (S.bullrunClosed) {
        widget.style.display = 'none';
        return;
    }

    widget.style.display = 'block';

    const total = 100000;
    const percentage = (S.bullrunCount / total) * 100;

    document.getElementById('bullrunBar').style.width = percentage + '%';
    document.getElementById('bullrunText').textContent =
        S.bullrunCount.toLocaleString() + ' / ' + total.toLocaleString();
}

function incrementBullrun() {
    S.bullrunCount += Math.floor(Math.random() * 3) + 1;
    localStorage.setItem('red_ai_bullrun_count', S.bullrunCount);
    updateBullrun();
}

function closeBullrun() {
    S.bullrunClosed = true;
    localStorage.setItem('red_ai_bullrun_closed', 'true');
    document.getElementById('bullrunWidget').style.display = 'none';
}

// Auto-increment every 2-5 minutes
function startBullrunInterval() {
    function scheduleNext() {
        const delay = Math.random() * (300000 - 120000) + 120000;
        setTimeout(() => {
            incrementBullrun();
            scheduleNext();
        }, delay);
    }
    setTimeout(() => {
        incrementBullrun();
        scheduleNext();
    }, 30000);
}

// Initialize bullrun widget when app starts
const originalStartApp = startApp;
startApp = function() {
    originalStartApp();
    updateBullrun();
    startBullrunInterval();
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// COMPLETION POPUP & CONFETTI
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function completeModule(moduleId) {
    if (!S.completedModules.includes(moduleId)) {
        S.completedModules.push(moduleId);
        localStorage.setItem('red_ai_completed', JSON.stringify(S.completedModules));
    }
    renderModuleList();
    showCompletionPopup(moduleId);
}

function showCompletionPopup(moduleId) {
    const total = Object.keys(MODULES).length;
    const completed = S.completedModules.length;
    const percentage = Math.round((completed / total) * 100);

    document.getElementById('progressCompleteLabel').textContent = `Fortschritt: ${percentage}%`;
    document.getElementById('completionOv').classList.add('show');

    setTimeout(() => {
        document.getElementById('progressCompleteFill').style.width = percentage + '%';
    }, 800);

    launchConfetti();

    S.nextModuleId = getNextModuleId(moduleId);
}

function getNextModuleId(currentId) {
    const moduleIds = Object.keys(MODULES);
    const currentIndex = moduleIds.indexOf(currentId);
    if (currentIndex < moduleIds.length - 1) {
        return moduleIds[currentIndex + 1];
    }
    return null;
}

function continueToNextModule() {
    document.getElementById('completionOv').classList.remove('show');
    document.getElementById('correctionOptions').classList.remove('show');
    document.getElementById('completionActions').style.display = 'flex';

    if (S.nextModuleId) {
        setTimeout(() => {
            selectModule(S.nextModuleId);
        }, 500);
    }
}

function showCorrectionOptions() {
    document.getElementById('completionActions').style.display = 'none';
    document.getElementById('correctionOptions').classList.add('show');
}

function correctField(field) {
    document.getElementById('completionOv').classList.remove('show');
    document.getElementById('correctionOptions').classList.remove('show');
    document.getElementById('completionActions').style.display = 'flex';

    // Restart intro module
    S.conversation = [];
    document.getElementById('chat').innerHTML = '';
    initModule('intro');
}

// Confetti animation
const confettiCanvas = document.getElementById('confetti');
const confettiCtx = confettiCanvas.getContext('2d');
let confettiParticles = [];

function launchConfetti() {
    confettiCanvas.width = window.innerWidth;
    confettiCanvas.height = window.innerHeight;
    confettiCanvas.classList.add('show');

    confettiParticles = [];
    for (let i = 0; i < 150; i++) {
        confettiParticles.push({
            x: Math.random() * confettiCanvas.width,
            y: -10,
            vx: (Math.random() - 0.5) * 4,
            vy: Math.random() * 3 + 2,
            color: ['#dc2626', '#ef4444', '#f97316', '#22c55e', '#3b82f6'][Math.floor(Math.random() * 5)],
            size: Math.random() * 8 + 4
        });
    }

    animateConfetti();

    setTimeout(() => {
        confettiCanvas.classList.remove('show');
        confettiParticles = [];
    }, 4000);
}

function animateConfetti() {
    if (confettiParticles.length === 0) return;

    confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);

    confettiParticles.forEach((p, i) => {
        p.x += p.vx;
        p.y += p.vy;
        p.vy += 0.1;

        if (p.y > confettiCanvas.height) {
            confettiParticles.splice(i, 1);
        }

        confettiCtx.fillStyle = p.color;
        confettiCtx.fillRect(p.x, p.y, p.size, p.size);
    });

    if (confettiParticles.length > 0) {
        requestAnimationFrame(animateConfetti);
    }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SETTINGS MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showApiKeySettings() {
    document.getElementById('settingsApiKey').value = S.apiKey || '';
    document.getElementById('settingsModal').classList.add('show');
    document.getElementById('settingsStatus').classList.remove('show');
}

function closeSettingsModal() {
    document.getElementById('settingsModal').classList.remove('show');
}

function saveApiKeySettings() {
    const newKey = document.getElementById('settingsApiKey').value.trim();
    const statusEl = document.getElementById('settingsStatus');

    if (!newKey || !newKey.startsWith('sk-ant-')) {
        statusEl.textContent = '‚ùå Ung√ºltiger API Key';
        statusEl.style.background = 'var(--accent-s)';
        statusEl.style.color = 'var(--accent)';
        statusEl.classList.add('show');
        return;
    }

    S.apiKey = newKey;
    localStorage.setItem('red_ai_api_key', newKey);

    statusEl.textContent = '‚úì API Key gespeichert!';
    statusEl.style.background = 'rgba(34,197,94,0.2)';
    statusEl.style.color = '#22c55e';
    statusEl.classList.add('show');

    setTimeout(() => {
        closeSettingsModal();
    }, 1500);
}

function resetEntireCourse() {
    const confirmMsg = 'M√∂chtest du wirklich den GESAMTEN Kurs neu starten? Alle Fortschritte werden gel√∂scht!';

    if (!confirm(confirmMsg)) {
        return;
    }

    // Clear all progress
    S.completedModules = [];
    S.conversation = [];
    S.profile = {};
    S.apiKey = null;

    // Clear localStorage completely
    localStorage.removeItem('red_ai_completed');
    localStorage.removeItem('red_ai_profile');
    localStorage.removeItem('red_ai_api_key');
    localStorage.removeItem('red_ai_bullrun_count');
    localStorage.removeItem('red_ai_bullrun_closed');

    // Reload page to start fresh (will show language + API key screen)
    location.reload();
}
</script>
</body>
</html>
